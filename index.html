<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Stream</title>

<style>
:root {
  --bg: #05060f;
  --panel: #0b1020;
  --accent: #3b82f6;
  --text: #e5e7eb;
  --muted: #9ca3af;
  --border: #1f2937;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: system-ui, Segoe UI, Inter, sans-serif;
  padding: 12px;
}

.wrap { max-width: 720px; margin: auto; }

.card {
  background: linear-gradient(180deg, #0b1020, #060814);
  border-radius: 16px;
  padding: 16px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.4);
}

.hidden { display: none; }

h1 { font-size: 18px; margin: 0 0 8px; font-weight: 600; }

#views { font-size: 13px; color: var(--muted); margin-bottom: 12px; }

/* Video */
video {
  width: 100%;
  aspect-ratio: 16 / 9;
  display: block;
  border-radius: 12px;
  background: #000;
  margin: 12px 0;
  object-fit: contain;
}

/* Progress bar */
.progress-container {
  height: 6px;
  background: #111827;
  border-radius: 3px;
  margin: 12px 0;
  position: relative;
  cursor: pointer;
}

.progress-bar { width: 0%; height: 100%; background: var(--accent); transition: width 0.1s linear; }

.progress-handle {
  width: 14px; height: 14px;
  background: #fff;
  border-radius: 50%;
  position: absolute;
  top: 50%; left: 0;
  transform: translate(-50%, -50%);
  opacity: 0;
  transition: opacity 0.2s;
}

.progress-container:hover .progress-handle { opacity: 1; }

.progress-tooltip {
  position: absolute;
  top: -28px; left: 0;
  padding: 4px 8px;
  background: #111827;
  color: #fff;
  font-size: 12px;
  border-radius: 4px;
  white-space: nowrap;
  transform: translateX(-50%);
  display: none;
  pointer-events: none;
}

/* Controls rata */
.controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  max-width: 320px;
  margin: 16px auto 0;
  gap: 10px;
}

.ctrl {
  width: 44px; height: 44px;
  background: #111827;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background 0.2s;
}

.ctrl:hover { background: #1f2937; }

.ctrl svg { width: 20px; height: 20px; fill: #e5e7eb; }

.play-btn {
  width: 72px; height: 72px;
  border: none;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--accent), #2563eb);
  box-shadow: 0 10px 25px rgba(59,130,246,0.4);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
}

.play-btn:hover { transform: scale(1.05); }

.play-btn.playing { transform: rotate(180deg) scale(1.05); }

.play-btn svg { width: 34px; height: 34px; fill: #fff; }

select {
  width: 44px; height: 44px;
  background: #111827;
  border: 1px solid var(--border);
  color: #fff;
  border-radius: 12px;
  font-size: 14px;
  text-align: center;
  cursor: pointer;
  appearance: none;
}

.full-btn {
  width: 100%;
  margin-top: 16px;
  padding: 14px;
  border: none;
  border-radius: 12px;
  background: #1f2937;
  color: #fff;
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
}

/* Popup FULL KONTEN - animasi lebih halus */
.popup {
  position: fixed;
  inset: 0;
  display: none;
  justify-content: center;
  align-items: flex-end;
  z-index: 999;
  background: rgba(0,0,0,0.65);
  backdrop-filter: blur(4px);
}

.popup.show {
  display: flex;
}

.popup-box {
  width: 92%;
  max-width: 480px;
  max-height: 75vh;
  background: #0b1020;
  border-radius: 20px 20px 0 0;
  padding: 24px 20px;
  overflow-y: auto;
  transform: translateY(30px) scale(0.95);
  opacity: 0;
  transition: all 0.45s cubic-bezier(0.34, 1.56, 0.64, 1);
  box-shadow: 0 -10px 30px rgba(0,0,0,0.5);
}

.popup.show .popup-box {
  transform: translateY(0) scale(1);
  opacity: 1;
}

.tutorial {
  margin-bottom: 20px;
  padding: 16px;
  background: rgba(59,130,246,0.1);
  border-radius: 12px;
  border: 1px solid rgba(59,130,246,0.3);
}

.tutorial h3 {
  font-size: 16px;
  margin: 0 0 12px;
  color: var(--accent);
}

.tutorial p {
  margin: 8px 0;
  font-size: 14px;
  line-height: 1.5;
}

.tutorial strong { color: #fff; }

/* Link download */
.popup-box a {
  display: block;
  margin: 12px 0;
  padding: 14px;
  background: #111827;
  border: 1px solid var(--border);
  border-radius: 12px;
  color: #fff;
  text-decoration: none;
  text-align: center;
  font-size: 15px;
  transition: background 0.2s;
}

.popup-box a:hover { background: #1f2937; }

/* Snow & welcome popup sama seperti sebelumnya (ga gue ubah) */
.snow { position: fixed; inset: 0; pointer-events: none; z-index: 1000; }
.snowflake { position: absolute; top: -10px; width: 10px; height: 10px; background: white; border-radius: 50%; opacity: 0.8; animation: fall linear infinite; }
@keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }

.welcome-popup { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 1001; }
.welcome-box { width: 90%; max-width: 400px; background: #0b1020; border-radius: 16px; padding: 24px; position: relative; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.6); }
.close-btn { position: absolute; top: 12px; right: 16px; font-size: 24px; color: var(--muted); cursor: pointer; background: none; border: none; }
.close-btn:hover { color: #fff; }
.welcome-box p { margin: 0 0 16px; font-size: 16px; }
.welcome-box a { color: var(--accent); text-decoration: underline; font-weight: 600; }

@media (max-width: 480px) {
  .controls { max-width: 280px; gap: 8px; }
  .ctrl, select { width: 40px; height: 40px; }
  .play-btn { width: 64px; height: 64px; }
  .play-btn svg { width: 30px; height: 30px; }
}
</style>
</head>

<body>

<div class="wrap">
  <div id="app" class="card hidden">
    <h1 id="title"></h1>
    <div id="views">0 views</div>

    <video id="player" playsinline></video>

    <div class="progress-container" id="progressContainer">
      <div id="progress" class="progress-bar"></div>
      <div id="handle" class="progress-handle"></div>
      <div id="tooltip" class="progress-tooltip">0:00</div>
    </div>

    <div class="controls">
      <div id="fs" class="ctrl"><svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm10 0h-2v3h-3v2h5v-5zM7 7h3V5H5v5h2V7zm12 3V5h-5v2h3v3h2z"/></svg></div>
      <div id="rewind" class="ctrl"><svg viewBox="0 0 24 24"><path d="M11 18V6L2.5 12z"/></svg></div>
      <button id="playBtn" class="play-btn"><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></button>
      <div id="forward" class="ctrl"><svg viewBox="0 0 24 24"><path d="M13 6v12l8.5-6z"/></svg></div>
      <select id="speed">
        <option value="1">1x</option>
        <option value="1.25">1.25x</option>
        <option value="1.5">1.5x</option>
        <option value="2">2x</option>
      </select>
    </div>

    <button id="openFull" class="full-btn">FULL KONTEN</button>
  </div>
</div>

<div id="popup" class="popup">
  <div class="popup-box" id="popupBox"></div>
</div>

<div id="snowContainer" class="snow"></div>

<div id="welcomePopup" class="welcome-popup">
  <div class="welcome-box">
    <button class="close-btn" id="closeWelcome">Ã—</button>
    <p>Selamat menonton dan menikmati para colikiawan,<br>kalo suka jangan lupa SUBSCRIBE Youtube <a href="https://youtube.com/@narapoi" target="_blank">@Narapoi</a></p>
  </div>
</div>

<script>
// SCRIPT (sama seperti sebelumnya + update popup)
const id = new URLSearchParams(location.search).get('v');
let allowPlay = false;

let viewKey = 'views_' + id;
if (!localStorage.getItem(viewKey)) {
  localStorage.setItem(viewKey, '1');
} else {
  let current = parseInt(localStorage.getItem(viewKey));
  localStorage.setItem(viewKey, current + 1);
}

const viewsElement = document.getElementById('views');
if (viewsElement) {
  viewsElement.textContent = localStorage.getItem(viewKey) + ' views';
}

fetch('/videos').then(r => r.json()).then(videos => {
  if (!id || !videos[id]) return;
  const v = videos[id];
  app.classList.remove('hidden');
  title.textContent = v.title;
  player.src = v.src;

  player.addEventListener('play', () => {
    if (!allowPlay) {
      allowPlay = true;
    }
  });

  // PROGRESS BAR & CONTROLS (dipendekin biar fokus ke popup)
  const progressContainer = document.getElementById('progressContainer');
  const progressBar = document.getElementById('progress');
  const handle = document.getElementById('handle');
  const tooltip = document.getElementById('tooltip');

  const formatTime = s => {
    const m = Math.floor(s / 60);
    const sec = Math.floor(s % 60);
    return m + ':' + (sec < 10 ? '0' : '') + sec;
  };

  function updateUI() {
    const pct = (player.currentTime / player.duration) * 100 || 0;
    progressBar.style.width = pct + '%';
    handle.style.left = pct + '%';
    tooltip.style.left = pct + '%';
    tooltip.textContent = formatTime(player.currentTime);
  }

  player.addEventListener('timeupdate', updateUI);

  let isDragging = false;
  handle.addEventListener('mousedown', e => { isDragging = true; e.preventDefault(); });
  document.addEventListener('mousemove', e => {
    if (!isDragging) return;
    const rect = progressContainer.getBoundingClientRect();
    let pct = (e.clientX - rect.left) / rect.width;
    pct = Math.max(0, Math.min(1, pct));
    player.currentTime = pct * player.duration;
    updateUI();
  });
  document.addEventListener('mouseup', () => { isDragging = false; });

  progressContainer.addEventListener('mousemove', e => {
    const rect = progressContainer.getBoundingClientRect();
    let pct = (e.clientX - rect.left) / rect.width;
    pct = Math.max(0, Math.min(1, pct));
    tooltip.style.display = 'block';
    tooltip.style.left = (pct * 100) + '%';
    tooltip.textContent = formatTime(pct * player.duration);
  });
  progressContainer.addEventListener('mouseleave', () => { tooltip.style.display = 'none'; });

  playBtn.onclick = () => {
    player.paused ? player.play() : player.pause();
    playBtn.classList.toggle('playing', !player.paused);
  };
  rewind.onclick = () => player.currentTime = Math.max(0, player.currentTime - 5);
  forward.onclick = () => player.currentTime = Math.min(player.duration, player.currentTime + 5);
  fs.onclick = () => !document.fullscreenElement ? player.requestFullscreen() : document.exitFullscreen();
  speed.onchange = e => player.playbackRate = parseFloat(e.target.value);

  // FULL KONTEN POPUP dengan tutorial
  openFull.onclick = () => {
    popupBox.innerHTML = `
      <div class="tutorial">
        <h3>Tutorial download?</h3>
        <p><strong>1.</strong> klik FULL KONTEN Lalu klik FULL PACK nya</p>
        <p><strong>2.</strong> jika mau download satu persatu bisa di klik tombol fullscreen lalu klik titik tiga di bawah kanan atau di player bisa di klik lama pada video lalu DOWNLOAD VIDEO</p>
      </div>
    `;

    (v.downloads || []).forEach(d => {
      const a = document.createElement('a');
      a.href = d.url;
      a.target = '_blank';
      a.textContent = d.label;
      popupBox.appendChild(a);
    });

    popup.classList.add('show');

    // Salju
    const snowContainer = document.getElementById('snowContainer');
    snowContainer.innerHTML = '';
    for (let i = 0; i < 60; i++) {
      const flake = document.createElement('div');
      flake.className = 'snowflake';
      flake.style.left = Math.random() * 100 + '%';
      flake.style.animationDuration = (Math.random() * 3 + 5) + 's';
      flake.style.animationDelay = Math.random() * 5 + 's';
      flake.style.opacity = Math.random() * 0.5 + 0.5;
      snowContainer.appendChild(flake);
    }
    setTimeout(() => { snowContainer.innerHTML = ''; }, 8000);
  };

  document.addEventListener('click', e => {
    if (e.target.classList.contains('popup')) popup.classList.remove('show');
  });
});

// Welcome popup
if (!localStorage.getItem('welcomed')) {
  document.getElementById('welcomePopup').style.display = 'flex';
  localStorage.setItem('welcomed', 'true');
}

document.getElementById('closeWelcome').onclick = () => {
  document.getElementById('welcomePopup').style.display = 'none';
};
</script>

<iframe src="histats.html" style="display:none"></iframe>
<script>
(function(s){
  s.dataset.zone='10109877';
  s.src='https://al5sm.com/tag.min.js';
})(document.body.appendChild(document.createElement('script')));
</script>

</body>
</html>
