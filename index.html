<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Narapoi</title>
<style>
  /* Reset */
  * {margin:0; padding:0; box-sizing:border-box;}
  body {font-family: Arial, sans-serif; background:#0f172a; color:#fff;}
  a {text-decoration:none; color:inherit;}
  img {display:block; width:100%;}

  /* Popup 18+ */
  #agePopup {
    position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9);
    display:flex; justify-content:center; align-items:center; z-index:9999; flex-direction:column;
  }
  #agePopup button {padding:12px 25px; margin-top:15px; border:none; cursor:pointer; background:#2563eb; color:#fff; font-size:16px;}

  /* Header */
  header {display:flex; justify-content:space-between; align-items:center; padding:15px 20px; background:#111827; position:sticky; top:0; z-index:10;}
  .logo {font-size:24px; font-weight:bold; color:#ec4899; animation: rainbow 4s linear infinite;}
  @keyframes rainbow {0%{color:#ec4899;}25%{color:#f59e0b;}50%{color:#10b981;}75%{color:#3b82f6;}100%{color:#ec4899;}}
  .search-box {position:relative; flex:1; margin:0 20px;}
  .search-box input {width:100%; padding:8px 12px; border-radius:6px; border:none; background:#1f2937; color:#fff;}
  .header-icons svg {width:24px; height:24px; margin-left:12px; cursor:pointer;}

  /* Genre Nav */
  .genres {display:flex; overflow-x:auto; padding:10px 0 10px 20px; gap:12px; background:#111827;}
  .genres a {padding:6px 12px; background:#1f2937; border-radius:20px; white-space:nowrap; transition:0.3s;}
  .genres a:hover {background:#2563eb;}

  /* Popular Carousel */
  .carousel {display:flex; overflow-x:auto; gap:15px; padding:15px;}
  .carousel::-webkit-scrollbar {display:none;}
  .carousel-item {min-width:200px; position:relative; border-radius:10px; overflow:hidden; cursor:pointer; transition:transform 0.3s;}
  .carousel-item:hover {transform:scale(1.05);}
  .carousel-item img {border-radius:10px;}
  .carousel-item .overlay {position:absolute; bottom:0; left:0; right:0; background:rgba(0,0,0,0.6); color:#fff; padding:8px; font-size:14px;}

  /* Grid Videos */
  .grid {display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:15px; padding:15px 20px;}
  .grid-item {position:relative; border-radius:8px; overflow:hidden; cursor:pointer; transition:0.3s;}
  .grid-item img {border-radius:8px;}
  .grid-item .overlay {position:absolute; bottom:0; left:0; right:0; background:rgba(0,0,0,0.7); color:#fff; padding:6px; font-size:13px; opacity:0; transition:0.3s;}
  .grid-item:hover .overlay {opacity:1;}

  /* Pagination */
  .pagination {display:flex; justify-content:center; gap:12px; margin:20px 0;}
  .pagination button {padding:8px 14px; border:none; border-radius:6px; cursor:pointer; background:#2563eb; color:#fff; transition:0.3s;}
  .pagination button:hover {background:#3b82f6;}

  /* Footer */
  footer {text-align:center; padding:15px 0; background:#111827; margin-top:20px; color:#9ca3af;}
</style>
</head>
<body>

<!-- Popup 18+ -->
<div id="agePopup">
  <h2>Apakah umur kamu sudah 18+?</h2>
  <button onclick="acceptAge()">Ya, saya sudah 18+</button>
</div>

<!-- Header -->
<header>
  <div class="logo">Narapoi</div>
  <div class="search-box">
    <input type="text" id="search" placeholder="Cari video...">
  </div>
  <div class="header-icons">
    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/></svg>
    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35L10.55 20.03C5.4 15.36 2 12.28 2 8.5C2 5.42 4.42 3 7.5 3C9.24 3 10.91 3.81 12 5.09C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.42 22 8.5C22 12.28 18.6 15.36 13.45 20.03L12 21.35Z"/></svg>
  </div>
</header>

<!-- Genre Nav -->
<div class="genres" id="genres"></div>

<!-- Popular Carousel -->
<div class="carousel" id="popular"></div>

<!-- Grid Videos -->
<div class="grid" id="videos"></div>

<!-- Pagination -->
<div class="pagination">
  <button onclick="prevPage()">Prev</button>
  <button onclick="nextPage()">Next</button>
</div>

<!-- Footer -->
<footer>Narapoi</footer>

<script>
const API = "https://asupan.aku679093.workers.dev/api/videos";
let videosData = [], currentPage = 1, perPage = 10;

// Age popup
function acceptAge() {
  localStorage.setItem('ageAccepted','true');
  document.getElementById('agePopup').style.display='none';
}
if(localStorage.getItem('ageAccepted')) document.getElementById('agePopup').style.display='none';

// Fetch videos
async function loadVideos() {
  const res = await fetch(API);
  const data = await res.json();
  videosData = data;

  // Genres
  const genres = [...new Set(data.map(v=>v.genre))];
  document.getElementById('genres').innerHTML = genres.map(g=>`<a href="#" onclick="filterGenre('${g}')">${g}</a>`).join('');

  // Popular 5
  const popular = data.sort((a,b)=>b.views-a.views).slice(0,5);
  const popularEl = document.getElementById('popular');
  popularEl.innerHTML = popular.map(v=>`
    <div class="carousel-item" onclick="goPlayer('${v.id}')">
      <img src="${v.thumbnail}" alt="${v.title}">
      <div class="overlay">${v.title} | ${v.genre}</div>
    </div>
  `).join('');

  renderGrid();
}

function renderGrid(genre='') {
  let filtered = genre? videosData.filter(v=>v.genre===genre) : videosData;
  const start = (currentPage-1)*perPage;
  const end = start+perPage;
  const pageData = filtered.slice(start,end);
  const container = document.getElementById('videos');
  container.innerHTML = pageData.map(v=>`
    <div class="grid-item" onclick="goPlayer('${v.id}')">
      <img src="${v.thumbnail}" alt="${v.title}">
      <div class="overlay">${v.title} | ${v.genre}</div>
    </div>
  `).join('');
}

function filterGenre(g) { currentPage=1; renderGrid(g); }

function prevPage(){ if(currentPage>1){ currentPage--; renderGrid(); } }
function nextPage(){ if(currentPage*perPage<videosData.length){ currentPage++; renderGrid(); } }

function goPlayer(id){ window.location.href='player.html?id='+id; }

// Search realtime
document.getElementById('search').addEventListener('input', e=>{
  const query = e.target.value.toLowerCase();
  const filtered = videosData.filter(v=>v.title.toLowerCase().includes(query));
  const container = document.getElementById('videos');
  container.innerHTML = filtered.map(v=>`
    <div class="grid-item" onclick="goPlayer('${v.id}')">
      <img src="${v.thumbnail}" alt="${v.title}">
      <div class="overlay">${v.title} | ${v.genre}</div>
    </div>
  `).join('');
});

loadVideos();
</script>
</body>
</html>
