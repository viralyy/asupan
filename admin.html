<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin</title>
  <style>
    :root{--bg:#0b0d10;--panel:#12161c;--text:#e8edf2;--muted:#9aa4af;--accent:#ff4d6d;--r:14px}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text)}
    .wrap{max-width:720px;margin:0 auto;padding:12px}
    a{color:inherit;text-decoration:none}
    .top{display:flex;gap:10px;margin-bottom:10px}
    .btn{padding:10px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.10);background:rgba(18,22,28,.9);color:var(--text)}
    h1{font-size:20px;margin:10px 0 10px}
    .card{background:rgba(18,22,28,.9);border:1px solid rgba(255,255,255,.06);border-radius:var(--r);padding:12px}
    label{display:block;color:var(--muted);font-size:12px;margin-top:10px}
    input, select{
      width:100%;padding:12px;margin-top:6px;border-radius:12px;
      border:1px solid rgba(255,255,255,.08);background:#0f1318;color:var(--text);outline:none
    }
    .row{display:flex;gap:10px}
    .row > div{flex:1}
    button.primary{
      width:100%;margin-top:12px;padding:12px;border-radius:12px;border:0;
      background:var(--accent);color:#fff;font-weight:800
    }
    pre{white-space:pre-wrap;margin-top:12px;color:var(--muted);font-size:12px}
    .hint{font-size:12px;color:var(--muted);margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <a class="btn" href="index.html">← Balik</a>
      <a class="btn" href="index.html" onclick="location.href='index.html';return false;">Home</a>
    </div>

    <h1>Admin</h1>

    <div class="card">
      <label>Judul</label>
      <input id="title" placeholder="Judul video..." />

      <label>Thumbnail URL (opsional)</label>
      <input id="thumb_url" placeholder="https://..." />

      <label>Video URL (mp4 / m3u8 / youtube)</label>
      <input id="video_url" placeholder="https://..." />

      <div class="row">
        <div>
          <label>Pilih Genre (opsional)</label>
          <select id="genre_pick">
            <option value="">(kosong)</option>
          </select>
        </div>
        <div>
          <label>Atau tulis genre baru</label>
          <input id="genre_new" placeholder="misal: asian, cosplay" />
        </div>
      </div>

      <div class="hint">Kalau isi “genre baru”, itu yang dipakai. Kalau kosong semua = tanpa genre.</div>

      <button class="primary" id="add">Tambah</button>

      <pre id="log"></pre>
    </div>
  </div>

  <script>
    const API = "https://asupanmu.aku679093.workers.dev";
    const logEl = document.getElementById("log");
    const log = (s) => (logEl.textContent = s + "\n" + logEl.textContent);

    async function loadGenres(){
      try{
        const res = await fetch(API + "/api/videos");
        const data = await res.json();
        const vids = data.videos || [];
        const genres = [...new Set(vids.map(v => (v.genre || "").trim()).filter(Boolean))].sort();

        const sel = document.getElementById("genre_pick");
        sel.innerHTML = `<option value="">(kosong)</option>` + genres.map(g => `<option value="${g}">${g}</option>`).join("");
      } catch {}
    }

    document.getElementById("add").onclick = async () => {
      const title = document.getElementById("title").value.trim();
      const video_url = document.getElementById("video_url").value.trim();
      const thumb_url = document.getElementById("thumb_url").value.trim();

      const pick = document.getElementById("genre_pick").value.trim();
      const typed = document.getElementById("genre_new").value.trim();
      const genre = (typed || pick || "").trim() || null;

      if (!title || !video_url) return log("isi title + video_url");

      const res = await fetch(API + "/api/admin/videos", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ title, video_url, thumb_url: thumb_url || null, genre }),
      });

      const data = await res.json();
      if (!data.ok) return log("gagal: " + JSON.stringify(data));

      log("SUKSES ✅ id=" + data.id + " kind=" + data.kind + (data.genre ? (" genre=" + data.genre) : ""));
      document.getElementById("title").value = "";
      document.getElementById("video_url").value = "";
      document.getElementById("thumb_url").value = "";
      document.getElementById("genre_new").value = "";
      document.getElementById("genre_pick").value = "";

      await loadGenres();
    };

    loadGenres();
  </script>
</body>
</html>
