<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Player - Narapoi</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',sans-serif;background:#0f172a;color:#fff;}
a{text-decoration:none;color:inherit;}

/* ================= Header ================= */
header{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;background:#111827;position:sticky;top:0;z-index:100;}
header .logo{font-size:1.8rem;font-weight:bold;color:#ec4899;}
header .search input{padding:8px 12px;border-radius:6px;border:none;background:#1f2937;color:#fff;width:100%;max-width:250px;}
header .search input::placeholder{color:#94a3b8;}

/* ================= Player ================= */
.player-container{padding:15px 20px;}
video{width:100%;aspect-ratio:16/9;border-radius:8px;background:#000;display:block;}

/* Video Info */
.video-info{display:flex;justify-content:space-between;padding:10px 0;font-size:14px;}
.video-info div{display:flex;gap:5px;align-items:center;}

/* Tombol Kembali */
#backBtn{display:inline-block;margin-top:10px;padding:6px 12px;border:none;border-radius:6px;background:#ef4444;color:#fff;cursor:pointer;transition:0.3s;font-size:14px;}
#backBtn:hover{background:#f87171;}

/* Tutorial + UNDUH FULL PACK */
#downloadContainer{margin-top:10px;}
#tutorial{font-weight:bold;color:#e5e7eb;font-size:15px;margin-bottom:8px;min-height:50px;white-space:pre-wrap;line-height:1.4;}
#downloadBtn{padding:10px 15px;border:none;border-radius:6px;background:#2563eb;color:#fff;cursor:pointer;transition:0.3s;display:block;width:100%;}
#downloadBtn:hover{background:#3b82f6;}

/* Sosial SVG */
#socials{display:flex;gap:10px;margin-top:10px;}
#socials a svg{width:28px;height:28px;fill:#fff;transition:0.3s;}
#socials a:hover svg{fill:#2563eb;}

/* ================= Related Videos ================= */
#related{display:grid;gap:15px;margin-top:20px;grid-template-columns:repeat(2,1fr);}
@media(min-width:768px){#related{grid-template-columns:repeat(2,1fr);}}
@media(min-width:1024px){#related{grid-template-columns:repeat(4,1fr);}}
.grid-item{border-radius:8px;overflow:hidden;transition:0.3s;cursor:pointer;}
.grid-item img{width:100%;height:auto;aspect-ratio:16/9;object-fit:cover;border-radius:6px;display:block;}
.grid-item .info{margin-top:6px;font-size:14px;background:rgba(0,0,0,0.6);padding:4px;border-radius:4px;opacity:0;transform:translateY(10px);transition:0.5s;}
.grid-item:hover .info{opacity:1;transform:translateY(0);}
.grid-item .info .title{font-weight:bold;margin-bottom:3px;}
.grid-item .info .genre{color:#94a3b8;font-size:13px;}

/* ================= Footer ================= */
footer{text-align:center;padding:15px 0;background:#111827;color:#9ca3af;margin-top:20px;font-size:0.9rem;display:flex;justify-content:center;gap:15px;}
footer a svg{fill:#9ca3af;transition:0.3s;width:20px;height:20px;}
footer a:hover svg{fill:#2563eb;}
</style>
</head>
<body>

<!-- Header -->
<header>
  <div class="logo">Narapoi</div>
  <div class="search">
    <input type="text" id="search" placeholder="Cari video...">
  </div>
</header>

<!-- Player -->
<div class="player-container">
  <video id="mainVideo" controls>
    <source id="videoSrc" src="" type="video/mp4">
    Browsermu tidak mendukung video.
  </video>

  <div class="video-info">
    <div>Genre: <span id="videoGenre"></span></div>
    <div>Views: <span id="videoViews">12345</span> | Online: <span id="videoOnline">67</span></div>
  </div>

  <!-- Tombol Kembali di bawah genre -->
  <button id="backBtn">Kembali</button>

  <!-- Tutorial + tombol UNDUH FULL PACK -->
  <div id="downloadContainer">
    <div id="tutorial"></div>
    <button id="downloadBtn">UNDUH FULL PACK</button>

    <!-- Sosial SVG WA & YouTube -->
    <div id="socials">
      <a href="#" target="_blank" title="WhatsApp">
        <svg viewBox="0 0 24 24"><path d="M12 0C5.372 0 0 5.373 0 12c0 2.11.554 4.08 1.514 5.816L0 24l6.242-1.602C8.922 23.444 10.95 24 12 24c6.627 0 12-5.373 12-12S18.627 0 12 0zm6.29 17.29c-.247.693-1.423 1.32-1.978 1.408-.529.082-1.172.116-5.147-2.543-4.183-2.69-4.008-2.507-4.662-2.802-.655-.293-1.137-.928-1.313-1.69-.178-.762-.1-1.66.555-2.33.657-.67.981-.76 1.313-.76.33 0 .635.024.913.024.277 0 .647-.083.99.627.343.71 1.166 2.46 1.27 2.635.103.176.171.384.035.618-.136.233-.2.36-.392.58-.196.22-.416.492-.593.66-.176.167-.358.37-.152.729.205.36.91 1.49 1.95 2.41 1.343 1.193 2.46 1.56 2.812 1.738.352.177.556.147.76-.088.203-.236.912-1.052 1.154-1.412.243-.36.486-.296.818-.177.33.12 2.09.985 2.452 1.164.361.177.603.264.69.414.086.15.086.866-.16 1.558z"/></svg>
      </a>
      <a href="#" target="_blank" title="YouTube">
        <svg viewBox="0 0 24 24"><path d="M23.498 6.186a2.993 2.993 0 0 0-2.114-2.123C19.6 3.5 12 3.5 12 3.5s-7.6 0-9.384.563A2.993 2.993 0 0 0 .502 6.186 31.22 31.22 0 0 0 0 12a31.22 31.22 0 0 0 .502 5.814 2.993 2.993 0 0 0 2.114 2.123C4.4 20.5 12 20.5 12 20.5s7.6 0 9.384-.563a2.993 2.993 0 0 0 2.114-2.123A31.22 31.22 0 0 0 24 12a31.22 31.22 0 0 0-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
      </a>
    </div>
  </div>
</div>

<!-- Related Videos -->
<div id="related"></div>

<!-- Footer -->
<footer>Narapoi | Socials: WA | Telegram | YouTube</footer>

<script>
const API="https://asupan.aku679093.workers.dev/api/videos";
const urlParams=new URLSearchParams(window.location.search);
const videoId=urlParams.get('id');
let videosData=[];

// ================= Back Button =================
document.getElementById('backBtn').onclick=()=>{window.history.back();}

// ================= Load Video =================
async function loadVideo(){
  const res=await fetch(API);
  videosData=await res.json();
  const video=videosData.find(v=>v.id===videoId) || videosData[0];
  if(!video) return;

  document.getElementById('videoSrc').src=video.video_url;
  document.getElementById('mainVideo').load();
  document.getElementById('videoGenre').innerText=video.genre;

  // Tutorial typing animation
  const tutorialEl=document.getElementById('tutorial');
  const text="TUTORIAL DOWNLOAD:\n1. Klik tombol 'UNDUH FULL PACK'\n2. Ikuti redirect iklan\n3. Setelah iklan selesai, video akan otomatis siap diunduh";
  typeWriter(tutorialEl,text,0);
}

// ================= Typing Animation =================
function typeWriter(el,text,i){
  if(i<text.length){
    el.innerHTML+=text.charAt(i);
    i++;
    setTimeout(()=>typeWriter(el,text,i),30);
  }
}

// ================= Download Button =================
document.getElementById('downloadBtn').onclick=()=>{
  const video=videosData.find(v=>v.id===videoId) || videosData[0];
  if(!video) return;

  const adLink="https://rm.riskilychous.com/iKZtvVhhVWc/131416";
  const finalLink=video.video_url;
  window.location.href=adLink;
  setTimeout(()=>{window.location.href=finalLink;},1000);
}

// ================= Related Videos =================
function renderRelated(){
  const shuffled=[...videosData].sort(()=>Math.random()-0.5).slice(0,10);
  const container=document.getElementById('related');
  container.innerHTML=shuffled.map(v=>`
    <div class="grid-item" onclick="window.location.href='player.html?id=${v.id}'">
      <img src="${v.thumbnail}" alt="${v.title}">
      <div class="info">
        <div class="title">${v.title}</div>
        <div class="genre">${v.genre}</div>
      </div>
    </div>
  `).join('');
}

// ================= Search =================
document.getElementById('search').addEventListener('input',e=>{
  const q=e.target.value.toLowerCase();
  const filtered=videosData.filter(v=>v.title.toLowerCase().includes(q));
  renderFiltered(filtered);
});
function renderFiltered(arr){
  const container=document.getElementById('related');
  container.innerHTML=arr.map(v=>`
    <div class="grid-item" onclick="window.location.href='player.html?id=${v.id}'">
      <img src="${v.thumbnail}" alt="${v.title}">
      <div class="info">
        <div class="title">${v.title}</div>
        <div class="genre">${v.genre}</div>
      </div>
    </div>
  `).join('');
}

// ================= Init =================
loadVideo();
renderRelated();
</script>
</body>
</html>
