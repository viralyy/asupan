<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Player - Narapoi</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Segoe UI,system-ui;background:#0f172a;color:#fff}
a{color:#60a5fa;text-decoration:none}

header{
  position:sticky;top:0;z-index:50;
  display:flex;justify-content:space-between;align-items:center;
  padding:14px 18px;background:#111827;
  border-bottom:1px solid rgba(255,255,255,.06)
}
.logo{font-size:20px;font-weight:800;color:#ec4899}
.search input{
  padding:9px 12px;border-radius:10px;
  background:#0b1220;border:1px solid rgba(255,255,255,.08);
  color:#fff
}

.wrap{max-width:1100px;margin:auto;padding:16px}
.card{
  background:rgba(17,24,39,.6);
  border:1px solid rgba(255,255,255,.06);
  border-radius:14px;padding:14px
}

video{width:100%;aspect-ratio:16/9;background:#000;border-radius:12px}

.meta{
  margin-top:12px;
  display:flex;justify-content:space-between;
  font-size:14px;color:#cbd5e1
}
.meta span{display:flex;align-items:center;gap:6px}
.meta svg{width:16px;height:16px;fill:#94a3b8}

#onlineDot{
  width:8px;height:8px;border-radius:50%;
  background:#22c55e;
  box-shadow:0 0 6px #22c55e;
  animation:blink 1.2s infinite
}
@keyframes blink{50%{opacity:.3}}

#backBtn{
  margin-top:12px;
  padding:8px 12px;border-radius:10px;
  background:#ef4444;border:0;color:#fff;
  font-weight:700;cursor:pointer
}

#tutorial{
  margin-top:12px;
  padding:12px;
  border-radius:12px;
  background:rgba(2,6,23,.55);
  border:1px solid rgba(255,255,255,.06);
  font-size:14px;line-height:1.55;white-space:pre-wrap
}

#downloadBtn{
  width:100%;margin-top:12px;
  padding:14px;border-radius:12px;
  background:#2563eb;border:0;
  color:#fff;font-weight:900;cursor:pointer
}

.social{
  margin-top:12px;
  display:flex;justify-content:center;gap:14px
}
.iconBtn{
  width:48px;height:48px;border-radius:12px;
  background:#0b1220;border:1px solid rgba(255,255,255,.08);
  display:flex;align-items:center;justify-content:center;
  cursor:pointer
}
.iconBtn svg{width:26px;height:26px}

#related{
  margin-top:16px;
  display:grid;grid-template-columns:repeat(2,1fr);gap:12px
}
@media(min-width:1024px){
  #related{grid-template-columns:repeat(4,1fr)}
}
.item{
  background:rgba(17,24,39,.55);
  border-radius:14px;overflow:hidden;
  border:1px solid rgba(255,255,255,.06);
  cursor:pointer
}
.thumb{width:100%;aspect-ratio:16/9;object-fit:cover}
.info{padding:10px}
.title{font-weight:800}
.genre{font-size:12px;color:#94a3b8}

footer{
  margin-top:18px;padding:18px;
  text-align:center;color:#94a3b8;
  background:#111827;border-top:1px solid rgba(255,255,255,.06)
}
</style>
</head>
<body>

<header>
  <div class="logo">Narapoi</div>
  <div class="search"><input placeholder="Cari video..."></div>
</header>

<div class="wrap">
<div class="card">

<video id="mainVideo" controls></video>

<div class="meta">
  <span>
    <!-- eye -->
    <svg viewBox="0 0 24 24"><path d="M12 5C5 5 1 12 1 12s4 7 11 7 11-7 11-7-4-7-11-7Zm0 11a4 4 0 1 1 0-8 4 4 0 0 1 0 8Z"/></svg>
    <b id="videoViews">0</b>
  </span>

  <span>
    <!-- user -->
    <svg viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4 0-8 2-8 5v1h16v-1c0-3-4-5-8-5Z"/></svg>
    <b id="videoOnline">0</b>
    <span id="onlineDot"></span>
  </span>
</div>

<button id="backBtn">Kembali</button>

<div id="tutorial">TUTORIAL DOWNLOAD FULL?
1. klik UNDUH FULL PACK
2. tunggu 3â€“5 detik lalu kembali
3. otomatis masuk link FULL
4. subscribe Youtube <a href="https://youtube.com/@narapoi" target="_blank">@Narapoi</a></div>

<button id="downloadBtn">UNDUH FULL PACK</button>

</div>

<h3 style="margin:16px 0">Video Lainnya</h3>
<div id="related"></div>
</div>

<footer>Narapoi</footer>

<script>
const API="https://asupan.aku679093.workers.dev/api/videos";
const FIREBASE="https://views-counter-b2398-default-rtdb.asia-southeast1.firebasedatabase.app";

const id=new URLSearchParams(location.search).get("id")||"default";
const today=new Date().toISOString().slice(0,10);
const viewKey=`view_${id}_${today}`;

async function addView(){
  const ref=`${FIREBASE}/videos/${id}.json`;
  let data=await (await fetch(ref)).json()||{views:0};

  if(!localStorage.getItem(viewKey)){
    data.views++;
    await fetch(ref,{
      method:"PUT",
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(data)
    });
    localStorage.setItem(viewKey,1);
  }
  document.getElementById("videoViews").innerText=data.views;
}

const onlineKey=Math.random().toString(36).slice(2);
fetch(`${FIREBASE}/online/${onlineKey}.json`,{
  method:"PUT",
  headers:{'Content-Type':'application/json'},
  body:JSON.stringify({id,t:Date.now()})
});

window.addEventListener("beforeunload",()=>{
  fetch(`${FIREBASE}/online/${onlineKey}.json`,{method:"DELETE"});
});

async function online(){
  const data=await (await fetch(`${FIREBASE}/online.json`)).json()||{};
  let c=0;
  Object.values(data).forEach(v=>{
    if(v.id===id && Date.now()-v.t<15000) c++;
  });
  document.getElementById("videoOnline").innerText=c;
}
setInterval(online,5000);

async function init(){
  const vids=await (await fetch(API)).json();
  const v=vids.find(x=>x.id==id)||vids[0];
  mainVideo.src=v.video_url;
  related.innerHTML=vids.sort(()=>Math.random()-.5).slice(0,10).map(v=>`
    <div class="item" onclick="location.href='player.html?id=${v.id}'">
      <img class="thumb" src="${v.thumbnail}">
      <div class="info"><div class="title">${v.title}</div><div class="genre">${v.genre}</div></div>
    </div>`).join("");
}

addView(); online(); init();
</script>

</body>
</html>
