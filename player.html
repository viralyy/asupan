<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Player - Narapoi</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Segoe UI,system-ui,-apple-system,Arial,sans-serif;background:#0f172a;color:#fff}
a{color:#60a5fa;text-decoration:none}
a:hover{text-decoration:underline}

header{
  position:sticky;top:0;z-index:50;
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 18px;background:#111827;
  border-bottom:1px solid rgba(255,255,255,.06)
}
.logo{font-size:20px;font-weight:800;color:#ec4899}
.search input{
  width:min(280px,52vw);
  padding:9px 12px;border-radius:10px;
  border:1px solid rgba(255,255,255,.08);
  background:#0b1220;color:#fff
}

.wrap{padding:16px 18px;max-width:1100px;margin:0 auto}
.card{
  background:rgba(17,24,39,.6);
  border:1px solid rgba(255,255,255,.06);
  border-radius:14px;
  padding:14px;
}

video{
  width:100%;
  aspect-ratio:16/9;
  background:#000;
  border-radius:12px;
}

.meta{
  margin-top:12px;
  font-size:14px;color:#cbd5e1
}

#backBtn{
  margin-top:12px;
  padding:8px 12px;border-radius:10px;border:0;
  background:#ef4444;color:#fff;font-weight:700
}

#tutorial{
  margin-top:12px;
  padding:12px;border-radius:12px;
  background:rgba(2,6,23,.55);
  border:1px solid rgba(255,255,255,.06);
  white-space:pre-wrap;font-size:14px;line-height:1.55
}

#downloadBtn{
  width:100%;margin-top:12px;
  padding:14px;border-radius:12px;
  border:0;background:#2563eb;
  color:#fff;font-weight:900;cursor:pointer
}

footer{
  margin-top:18px;padding:18px 0;
  text-align:center;color:#94a3b8;
  border-top:1px solid rgba(255,255,255,.06);
  background:#111827
}
</style>
</head>
<body>

<header>
  <div class="logo">Narapoi</div>
  <div class="search">
    <input placeholder="Cari video...">
  </div>
</header>

<div class="wrap">
  <div class="card">

    <video id="mainVideo" controls>
      <source id="videoSrc" src="">
    </video>

    <div class="meta">
      Genre: <b id="videoGenre">-</b>
    </div>

    <button id="backBtn">Kembali</button>

    <div id="tutorial">TUTORIAL DOWNLOAD FULL?
1. klik UNDUH FULL PACK
2. Tunggu 3â€“5 detik
3. Akan otomatis diarahkan ke FULL KONTEN
4. Support admin dengan mematikan VPN / DNS</div>

    <button id="downloadBtn">UNDUH FULL PACK</button>

  </div>
</div>

<footer>Narapoi</footer>

<script>
/* ================= CONFIG ================= */
const API = "https://asupan.aku679093.workers.dev/api/videos";
const params = new URLSearchParams(location.search);
const videoId = params.get("id") || "default";

/* ================= GLOBAL ================= */
let videos=[], currentVideo=null;
let FULL_URL=null;
let BLOCKED=false;

/* ================= UI ================= */
backBtn.onclick = () => history.back();

downloadBtn.onclick = () => {
  if(BLOCKED) return;
  if(FULL_URL){
    location.href = FULL_URL;
  }else{
    alert("Link FULL PACK belum tersedia.");
  }
};

/* ================= ANTI ADBLOCK / VPN ================= */
function blockAccess(reason){
  BLOCKED=true;
  mainVideo.pause();
  mainVideo.removeAttribute("src");

  const modal=document.createElement("div");
  modal.style=`
    position:fixed;inset:0;z-index:9999;
    background:rgba(2,6,23,.96);
    display:flex;align-items:center;justify-content:center;
    text-align:center;padding:24px
  `;
  modal.innerHTML=`
    <div style="max-width:420px">
      <h2 style="margin-bottom:12px">Akses Dibatasi</h2>
      <p style="color:#cbd5e1;margin-bottom:16px">
        Untuk mengakses video & FULL PACK,<br>
        mohon <b>matikan VPN / DNS / Adblock</b><br>
        demi mendukung server kami.
      </p>
      <small style="color:#94a3b8">${reason}</small><br><br>
      <button onclick="location.reload()" style="
        padding:12px 18px;border-radius:10px;
        border:0;background:#2563eb;
        color:#fff;font-weight:800
      ">Reload Halaman</button>
    </div>
  `;
  document.body.appendChild(modal);
}

/* ==== ADBLOCK DETECT ==== */
(()=>{
  const bait=document.createElement("script");
  bait.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js";
  bait.onerror=()=>blockAccess("Adblock terdeteksi");
  document.head.appendChild(bait);
})();

/* ==== VPN / DNS DETECT ==== */
(async()=>{
  try{
    await fetch("https://cloudflare.com/cdn-cgi/trace",{mode:"no-cors"});
  }catch{
    blockAccess("VPN / DNS terdeteksi");
  }
})();

/* ================= INIT ================= */
(async()=>{
  const r=await fetch(API);
  videos=await r.json();
  currentVideo=videos.find(v=>v.id==videoId)||videos[0];

  if(currentVideo){
    videoSrc.src=currentVideo.video_url;
    mainVideo.load();
    videoGenre.innerText=currentVideo.genre||"-";
    FULL_URL=currentVideo.full_url||null;
  }
})();
</script>

</body>
</html>
