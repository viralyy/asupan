<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin Panel - Narapoi</title>
<style>
body{font-family:Segoe UI,system-ui,-apple-system,Arial,sans-serif;background:#0f172a;color:#fff;margin:0;padding:0}
header{padding:16px;background:#111827;text-align:center;font-size:22px;font-weight:800;color:#ec4899}
.wrap{padding:16px;max-width:1100px;margin:0 auto}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{padding:12px;text-align:left;border-bottom:1px solid rgba(255,255,255,.1)}
th{background:#1e293b}
input,button{padding:8px 12px;border-radius:8px;border:none;font-size:14px}
input{width:100%;margin-bottom:6px}
button{cursor:pointer}
.addForm{background:#111827;padding:12px;border-radius:12px;margin-top:12px}
button.update{background:#2563eb;color:#fff;margin-right:6px}
button.delete{background:#ef4444;color:#fff}
</style>
</head>
<body>

<header>Admin Panel - Narapoi</header>
<div class="wrap">

<h3>Tambah Video Baru</h3>
<div class="addForm">
  <input id="newTitle" placeholder="Judul Video">
  <input id="newGenre" placeholder="Genre">
  <input id="newVideoUrl" placeholder="URL Video">
  <input id="newFullPack" placeholder="URL FULL PACK">
  <button id="addBtn">Tambah Video</button>
</div>

<h3>Daftar Video</h3>
<table>
  <thead>
    <tr>
      <th>Judul</th>
      <th>Genre</th>
      <th>Video URL</th>
      <th>FULL PACK URL</th>
      <th>Aksi</th>
    </tr>
  </thead>
  <tbody id="videoTable"></tbody>
</table>

</div>

<script>
const WORKER_API = "https://worker-narapoi.example.workers.dev/api/videos";

async function loadVideos(){
  const r = await fetch(WORKER_API);
  const videos = await r.json();
  const tbody = document.getElementById("videoTable");
  tbody.innerHTML = videos.map(v => `
    <tr>
      <td><input value="${v.title}" data-id="${v.id}" data-field="title"></td>
      <td><input value="${v.genre}" data-id="${v.id}" data-field="genre"></td>
      <td><input value="${v.video_url}" data-id="${v.id}" data-field="video_url"></td>
      <td><input value="${v.full_pack||''}" data-id="${v.id}" data-field="full_pack"></td>
      <td>
        <button class="update" data-id="${v.id}">Update</button>
        <button class="delete" data-id="${v.id}">Hapus</button>
      </td>
    </tr>
  `).join("");
  
  document.querySelectorAll(".update").forEach(btn => {
    btn.onclick = async () => {
      const id = btn.dataset.id;
      const rowInputs = document.querySelectorAll(`input[data-id="${id}"]`);
      const payload = {};
      rowInputs.forEach(i => payload[i.dataset.field] = i.value);
      try{
        await fetch(`${WORKER_API}/${id}`, {
          method: "PUT",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(payload)
        });
        alert("Video diupdate!");
        loadVideos();
      }catch(e){alert("Gagal update")}
    }
  });

  document.querySelectorAll(".delete").forEach(btn => {
    btn.onclick = async () => {
      const id = btn.dataset.id;
      if(!confirm("Yakin hapus video ini?")) return;
      try{
        await fetch(`${WORKER_API}/${id}`, {method:"DELETE"});
        alert("Video dihapus!");
        loadVideos();
      }catch(e){alert("Gagal hapus")}
    }
  });
}

document.getElementById("addBtn").onclick = async () => {
  const title = document.getElementById("newTitle").value;
  const genre = document.getElementById("newGenre").value;
  const video_url = document.getElementById("newVideoUrl").value;
  const full_pack = document.getElementById("newFullPack").value;
  if(!title||!video_url) return alert("Judul dan URL Video wajib diisi");
  try{
    await fetch(WORKER_API, {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({title,genre,video_url,full_pack})
    });
    alert("Video ditambahkan!");
    document.getElementById("newTitle").value="";
    document.getElementById("newGenre").value="";
    document.getElementById("newVideoUrl").value="";
    document.getElementById("newFullPack").value="";
    loadVideos();
  }catch(e){alert("Gagal tambah video")}
}

loadVideos();
</script>

</body>
</html>
