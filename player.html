<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Player - Narapoi</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',sans-serif;background:#0f172a;color:#fff;}
a{text-decoration:none;color:inherit;}

/* Header */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:15px 20px;
  background:#111827;
  position:sticky;
  top:0;
  z-index:100;
}
header .logo{font-size:1.8rem;font-weight:bold;color:#ec4899;}
header .search input{
  padding:8px 12px;
  border-radius:6px;
  border:none;
  background:#1f2937;
  color:#fff;
  width:100%;
  max-width:250px;
}
header .search input::placeholder{color:#94a3b8;}

/* Player */
.player-container{padding:15px 20px;}
video{
  width:100%;
  aspect-ratio:16/9;
  border-radius:8px;
  background:#000;
  display:block;
  box-shadow:0 4px 12px rgba(0,0,0,0.5);
  margin-bottom:10px;
}

/* Video Info */
.video-info{
  display:flex;
  justify-content:space-between;
  padding:10px 0;
  font-size:14px;
}
.video-info div{display:flex;gap:5px;align-items:center;}

/* Tombol Kembali */
#backBtn{
  display:inline-block;
  margin-top:10px;
  padding:6px 12px;
  border:none;
  border-radius:6px;
  background:#ef4444;
  color:#fff;
  cursor:pointer;
  font-size:14px;
}

/* Download Container */
#downloadContainer{
  margin-top:15px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:12px;
}

/* Tutorial Download */
#tutorial{
  font-weight:bold;
  font-size:15px;
  color:#e5e7eb;
  text-align:center;
  min-height:60px;
  white-space:pre-wrap;
  line-height:1.4;
}

/* Tombol UNDUH FULL PACK */
#downloadBtn{
  padding:14px 20px;
  width:100%;
  max-width:100%;
  border:none;
  border-radius:8px;
  background:#2563eb;
  color:#fff;
  font-size:16px;
  font-weight:bold;
  cursor:pointer;
}

/* Tombol Sosial (Logo Only) */
.social-btns{
  display:flex;
  justify-content:center;
  gap:20px;
  margin-top:10px;
}
.social-btns button{
  width:50px;
  height:50px;
  border:none;
  border-radius:8px;
  background:#1f2937;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
.social-btns img{width:28px;height:28px;}

/* Related Videos */
#related{
  display:grid;
  gap:15px;
  margin-top:20px;
  grid-template-columns:repeat(2,1fr);
}
@media(min-width:768px){#related{grid-template-columns:repeat(2,1fr);}}
@media(min-width:1024px){#related{grid-template-columns:repeat(4,1fr);}}
.grid-item{border-radius:8px;overflow:hidden;cursor:pointer;position:relative;}
.grid-item img{width:100%;height:auto;aspect-ratio:16/9;object-fit:cover;border-radius:6px;display:block;}
.grid-item .info{
  position:absolute;
  bottom:0;
  left:0;
  right:0;
  background:rgba(0,0,0,0.6);
  padding:6px;
}
.grid-item .info .title{font-weight:bold;color:#fff;}
.grid-item .info .genre{color:#94a3b8;font-size:13px;}

/* Footer */
footer{
  text-align:center;
  padding:15px 0;
  background:#111827;
  color:#9ca3af;
  margin-top:20px;
  font-size:0.9rem;
}
</style>
</head>
<body>

<header>
  <div class="logo">Narapoi</div>
  <div class="search">
    <input type="text" id="search" placeholder="Cari video...">
  </div>
</header>

<div class="player-container">
  <video id="mainVideo" controls>
    <source id="videoSrc" src="" type="video/mp4">
    Browsermu tidak mendukung video.
  </video>

  <div class="video-info">
    <div>Genre: <span id="videoGenre"></span></div>
    <div>Views: <span id="videoViews">12345</span> | Online: <span id="videoOnline">67</span></div>
  </div>

  <!-- Tombol Kembali -->
  <button id="backBtn">Kembali</button>

  <!-- Download Container -->
  <div id="downloadContainer">
    <!-- Tutorial Download -->
    <div id="tutorial"></div>

    <!-- Tombol UNDUH FULL PACK -->
    <button id="downloadBtn">UNDUH FULL PACK</button>

    <!-- Tombol Sosial Logo Only -->
    <div class="social-btns">
      <button id="waBtn"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/whatsapp.svg" alt="WA"></button>
      <button id="ytBtn"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/youtube.svg" alt="YT"></button>
    </div>
  </div>
</div>

<!-- Related Videos -->
<div id="related"></div>

<footer>Narapoi</footer>

<script>
const API="https://asupan.aku679093.workers.dev/api/videos";
const urlParams=new URLSearchParams(window.location.search);
const videoId=urlParams.get('id');
let videosData=[];

// Tombol Kembali
document.getElementById('backBtn').onclick=()=>{window.history.back();}

// Load Video
async function loadVideo(){
  try{
    const res=await fetch(API);
    videosData=await res.json();

    const video=videoId ? videosData.find(v=>v.id===videoId) : videosData[0];
    if(!video) return;

    document.getElementById('videoSrc').src=video.video_url;
    document.getElementById('mainVideo').load();
    document.getElementById('videoGenre').innerText=video.genre;

    // Tutorial selalu muncul
    const tutorialEl=document.getElementById('tutorial');
    tutorialEl.innerHTML="TUTORIAL DOWNLOAD:\n1. Klik tombol 'UNDUH FULL PACK'\n2. Ikuti redirect iklan\n3. Setelah iklan selesai, video akan otomatis siap diunduh";

    // Tombol download langsung muncul
    document.getElementById('downloadBtn').style.display='block';

    // Tombol sosial langsung muncul
    document.querySelector('.social-btns').style.display='flex';
  }catch(err){
    console.error("Error load video:",err);
  }
}

// Tombol UNDUH FULL PACK
document.getElementById('downloadBtn').onclick=()=>{
  const video=videoId ? videosData.find(v=>v.id===videoId) : videosData[0];
  if(!video) return;

  const adLink="https://rm.riskilychous.com/iKZtvVhhVWc/131416";
  const finalLink=video.video_url;
  window.location.href=adLink;
  setTimeout(()=>{window.location.href=finalLink;},1000);
}

// Sosial Buttons
document.getElementById('waBtn').onclick=()=>{window.open("#","_blank");}
document.getElementById('ytBtn').onclick=()=>{window.open("#","_blank");}

// Related Videos
function renderRelated(){
  const shuffled=[...videosData].sort(()=>Math.random()-0.5).slice(0,10);
  const container=document.getElementById('related');
  container.innerHTML=shuffled.map(v=>`
    <div class="grid-item" onclick="window.location.href='player.html?id=${v.id}'">
      <img src="${v.thumbnail}" alt="${v.title}">
      <div class="info">
        <div class="title">${v.title}</div>
        <div class="genre">${v.genre}</div>
      </div>
    </div>
  `).join('');
}

// Search
document.getElementById('search').addEventListener('input',e=>{
  const q=e.target.value.toLowerCase();
  const filtered=videosData.filter(v=>v.title.toLowerCase().includes(q));
  const container=document.getElementById('related');
  container.innerHTML=filtered.map(v=>`
    <div class="grid-item" onclick="window.location.href='player.html?id=${v.id}'">
      <img src="${v.thumbnail}" alt="${v.title}">
      <div class="info">
        <div class="title">${v.title}</div>
        <div class="genre">${v.genre}</div>
      </div>
    </div>
  `).join('');
});

// Init
loadVideo();
renderRelated();
</script>
</body>
</html>
