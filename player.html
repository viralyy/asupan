<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Player - Narapoi</title>
<style>
/* ================= Base ================= */
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',sans-serif;background:#0f172a;color:#fff;}
a{text-decoration:none;color:inherit;}

/* ================= Header ================= */
header{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;background:#111827;position:sticky;top:0;z-index:100;}
header .logo{font-size:1.8rem;font-weight:bold;color:#ec4899;}
header .search input{padding:8px 12px;border-radius:6px;border:none;background:#1f2937;color:#fff;width:100%;max-width:250px;}
header .search input::placeholder{color:#94a3b8;}

/* ================= Player ================= */
.player-container{padding:15px 20px;}
video{width:100%;aspect-ratio:16/9;border-radius:8px;background:#000;display:block;}
.video-info{display:flex;justify-content:space-between;padding:10px 0;font-size:14px;}
.video-info div{display:flex;gap:5px;align-items:center;}

/* ================= Back Button ================= */
#backBtn{display:inline-block;margin-top:10px;padding:6px 12px;border:none;border-radius:6px;background:#ef4444;color:#fff;cursor:pointer;transition:0.3s;font-size:14px;}
#backBtn:hover{background:#f87171;}

/* ================= Tutorial + UNDUH FULL PACK ================= */
#downloadContainer{margin-top:10px;}
#tutorial{font-weight:bold;color:#e5e7eb;font-size:15px;margin-bottom:8px;min-height:50px;white-space:pre-wrap;line-height:1.4;}
#downloadBtn{padding:10px 15px;border:none;border-radius:6px;background:#2563eb;color:#fff;cursor:pointer;transition:0.3s;display:block;width:100%;}
#downloadBtn:hover{background:#3b82f6;}

/* ================= Related Videos ================= */
#related{display:grid;gap:15px;margin-top:20px;grid-template-columns:repeat(2,1fr);}
@media(min-width:768px){#related{grid-template-columns:repeat(2,1fr);}}
@media(min-width:1024px){#related{grid-template-columns:repeat(4,1fr);}}
.grid-item{border-radius:8px;overflow:hidden;transition:0.3s;cursor:pointer;}
.grid-item img{width:100%;height:auto;aspect-ratio:16/9;object-fit:cover;border-radius:6px;display:block;}
.grid-item .info{margin-top:6px;font-size:14px;background:rgba(0,0,0,0.6);padding:4px;border-radius:4px;opacity:0;transform:translateY(10px);transition:0.5s;}
.grid-item:hover .info{opacity:1;transform:translateY(0);}
.grid-item .info .title{font-weight:bold;margin-bottom:3px;}
.grid-item .info .genre{color:#94a3b8;font-size:13px;}

/* ================= Footer ================= */
footer{text-align:center;padding:15px 0;background:#111827;color:#9ca3af;margin-top:20px;font-size:0.9rem;display:flex;justify-content:center;gap:15px;}
footer a svg{fill:#9ca3af;transition:0.3s;width:20px;height:20px;}
footer a:hover svg{fill:#2563eb;}
</style>
</head>
<body>

<!-- Header -->
<header>
  <div class="logo">Narapoi</div>
  <div class="search">
    <input type="text" id="search" placeholder="Cari video...">
  </div>
</header>

<!-- Player -->
<div class="player-container">
  <video id="mainVideo" controls>
    <source id="videoSrc" src="" type="video/mp4">
    Browsermu tidak mendukung video.
  </video>

  <div class="video-info">
    <div>Genre: <span id="videoGenre"></span></div>
    <div>Views: <span id="videoViews">12345</span> | Online: <span id="videoOnline">67</span></div>
  </div>

  <!-- Tombol Kembali di bawah genre -->
  <button id="backBtn">Kembali</button>

  <!-- Tutorial + tombol UNDUH FULL PACK -->
  <div id="downloadContainer">
    <div id="tutorial"></div>
    <button id="downloadBtn">UNDUH FULL PACK</button>
  </div>
</div>

<!-- Related Videos -->
<div id="related"></div>

<!-- Footer -->
<footer>Narapoi | Socials: WA | Telegram | YouTube</footer>

<script>
const API="https://asupan.aku679093.workers.dev/api/videos";
const urlParams=new URLSearchParams(window.location.search);
const videoId=urlParams.get('id');
let videosData=[];

// ================= Back Button =================
document.getElementById('backBtn').onclick=()=>{window.history.back();}

// ================= Load Video =================
async function loadVideo(){
  const res=await fetch(API);
  videosData=await res.json();
  const video=videosData.find(v=>v.id===videoId) || videosData[0];
  if(!video) return;

  document.getElementById('videoSrc').src=video.video_url;
  document.getElementById('mainVideo').load();
  document.getElementById('videoGenre').innerText=video.genre;

  // Tampilkan tutorial dengan typing animation
  const tutorialEl=document.getElementById('tutorial');
  const text="TUTORIAL DOWNLOAD:\n1. Klik tombol 'UNDUH FULL PACK'\n2. Ikuti redirect iklan\n3. Setelah iklan selesai, video akan otomatis siap diunduh";
  typeWriter(tutorialEl,text,0);
}

// ================= Typing Animation =================
function typeWriter(el,text,i){
  if(i<text.length){
    el.innerHTML+=text.charAt(i);
    i++;
    setTimeout(()=>typeWriter(el,text,i),30);
  }
}

// ================= Download Button =================
document.getElementById('downloadBtn').onclick=()=>{
  const video=videosData.find(v=>v.id===videoId) || videosData[0];
  if(!video) return;

  const adLink="https://rm.riskilychous.com/iKZtvVhhVWc/131416";
  const finalLink=video.video_url;
  window.location.href=adLink;
  setTimeout(()=>{window.location.href=finalLink;},1000);
}

// ================= Related Videos =================
function renderRelated(){
  const shuffled=[...videosData].sort(()=>Math.random()-0.5).slice(0,10);
  const container=document.getElementById('related');
  container.innerHTML=shuffled.map(v=>`
    <div class="grid-item" onclick="window.location.href='player.html?id=${v.id}'">
      <img src="${v.thumbnail}" alt="${v.title}">
      <div class="info">
        <div class="title">${v.title}</div>
        <div class="genre">${v.genre}</div>
      </div>
    </div>
  `).join('');
}

// ================= Search =================
document.getElementById('search').addEventListener('input',e=>{
  const q=e.target.value.toLowerCase();
  const filtered=videosData.filter(v=>v.title.toLowerCase().includes(q));
  renderFiltered(filtered);
});
function renderFiltered(arr){
  const container=document.getElementById('related');
  container.innerHTML=arr.map(v=>`
    <div class="grid-item" onclick="window.location.href='player.html?id=${v.id}'">
      <img src="${v.thumbnail}" alt="${v.title}">
      <div class="info">
        <div class="title">${v.title}</div>
        <div class="genre">${v.genre}</div>
      </div>
    </div>
  `).join('');
}

// ================= Init =================
loadVideo();
renderRelated();
</script>
</body>
</html>
